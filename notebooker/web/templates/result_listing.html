{% import "header.html" as header %}

{{ header.notebookerHeader(readonly_mode, scheduler_disabled) }}

<html>
<head>
    <script type="application/javascript">
        var REPORT_NAME = "{{ report_name }}";
        var LIMIT = "{{ result_limit }}";
        var READONLY_MODE = "{{ readonly_mode|safe }}";
    </script>
    <script type="application/javascript" src="{{ url_for('static', filename='notebooker/result_listing.js') }}"></script>
</head>
<body>

    {{ header.sidebar(all_reports) }}
    <span id="failedLoad" style="display: none;">
        <h2>Couldn't load any reports!</h2>
        Either we haven't run any reports yet, or you don't have permission to view any on this Notebooker
        instance. Please check with the instance admin.
    </span>
    <div class="ui centered grid" style="display:none" id="indexTableContainer">
        <div class="twelve wide column">
            <h1 class="ui huge centered header">{{ titleised_report_name }} ({{ report_name }})</h1>
        </div>
        <div class="fifteen wide column">
            <table id="resultsTable" class="ui sortable selectable padded table">
            </table>
        </div>
        <div class="row">
            {% if n_results_available != result_limit and n_results_available > result_limit %}
            <div class="three wide column">
                <div>
                    <a class="ui button black" id="moreResultsButton" href="?limit={{ n_results_available }}">
                        Load all {{ n_results_available }} results
                    </a>
                </div>
            </div>
            {% endif %}
            {% if not readonly_mode %}
            <div class="three wide column" style="display: flex;">
                <a class="ui button green" id="runReportButton" href="/run_report/{{ report_name }}" style="margin-right: 40px;">
                    Manually run this report
                </a>
                <button class="ui button red" id="deleteAllReportsButton" data-href="/delete_all_reports/{{ report_name }}">
                    Delete all reports
                </button>
            </div>
            {% endif %}
        </div>
    </div>
        <div class="ui modal" id="deleteModal">
          <div class="header">Delete report</div>
          <div class="content">
            <p>Are you sure you wish to delete this report?</p>
          </div>
          <div class="actions">
            <div class="ui approve button red">Delete</div>
            <div class="ui cancel button">Cancel</div>
          </div>
        </div>
<script type="application/javascript">
    document.getElementById('deleteAllReportsButton').addEventListener('click', function(e) {
        e.preventDefault();
        var confirmed = confirm('Are you sure you wish to delete all reports?');
        if (confirmed) {
            // Show the spinner
            document.getElementById('spinner').style.display = 'block';

            // Use fetch API to make the request
            fetch(this.getAttribute('data-href'))
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    // Hide the spinner
                    document.getElementById('spinner').style.display = 'none';
                    // Refresh the page or redirect as needed
                    window.location.reload();
                })
                .catch(error => {
                    console.error('There has been a problem with your fetch operation:', error);
                    // Hide the spinner
                    document.getElementById('spinner').style.display = 'none';
                });
        }
    });
</script>
<!-- Spinner -->
<div id="spinner" style="display: none;">
    <div class="loader"></div>
</div>

<!-- CSS for the spinner -->
<style>
#spinner {
  display: flex;
  justify-content: center;
  align-items: center;
  position: absolute;
  z-index: 9999;
  width: 100%;
  height: 100%;
  overflow: auto;
  top: 0:
  left: 0;
}

.loader {
  border: 16px solid #f3f3f3;
  border-radius: 50%;
  border-top: 16px solid #3498db;
  width: 120px;
  height: 120px;
  -webkit-animation: spin 2s linear infinite; /* Safari */
  animation: spin 2s linear infinite;
  margin: auto;
}

/* Safari */
@-webkit-keyframes spin {
  0% { -webkit-transform: rotate(0deg); }
  100% { -webkit-transform: rotate(360deg); }
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}
</style>
</body>
</html>
